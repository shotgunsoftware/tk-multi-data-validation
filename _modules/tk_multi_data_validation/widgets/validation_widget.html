

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>tk_multi_data_validation.widgets.validation_widget &mdash; tk-multi-data-validation v0.1.6 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    <a href='https://help.autodesk.com/view/SGDEV/ENU/'>
    
        <img style='width: 191px;
                height: 60px;
                margin: 2px;
                border-radius: 0px;
                padding: 0px;'
            src='../../../_static/logo@2x.png'/>
    
    </a>
    

          
          
          <a href="../../../index.html" class="icon icon-home">
            tk-multi-data-validation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../using_the_app.html">Using the Data Validation App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../customization.html">Customizing the Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../settings.html">App Config Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference.html">Reference</a></li>
</ul>


    <a href='genindex.html'>Alphabetic Index</a>

    <div style='margin-top: 50px;
                margin-left: 10px;
                margin-right: 10px;
                padding: 10px;
                color: #b3b3b3;
                font-size: 70%;
                border-radius: 3px;
                background-color: #444;
                line-height: 18px;
                '>
    <style>
        a.custom_post_menu { display: inline;
                             padding: 0px;
                             text-decoration: underline; }
    </style>

    <b>tk-multi-data-validation</b> v0.1.6.<br>
    
        This documentation is part of the Flow Production Tracking.
    
    For more information, please visit
    <a class=custom_post_menu href='https://help.autodesk.com/view/SGDEV/ENU/'>The Flow Production Tracking developer portal.</a>.
    The code associated with this documentation can be found
    <a class=custom_post_menu href='https://github.com/shotgunsoftware/tk-multi-data-validation'>here</a>.

    </div>
    <style>
        p.privacy_links { margin: 4px 0px;}
    </style>
    <p class="privacy_links"><a data-opt-in-preferences href="javascript:;">Privacy settings</a></p>
    <p class="privacy_links"><a data-wat-linkname="manage-ccpa-settings-footer-link" href="javascript:;">Do not sell my personal information</a></p>
    <p class="privacy_links"><a href="https://www.autodesk.com/company/legal-notices-trademarks/privacy-statement">Privacy/Cookies</a></p>



        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">tk-multi-data-validation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">tk_multi_data_validation.widgets.validation_widget</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for tk_multi_data_validation.widgets.validation_widget</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2022 Autodesk, Inc.</span>
<span class="c1">#</span>
<span class="c1"># CONFIDENTIAL AND PROPRIETARY</span>
<span class="c1">#</span>
<span class="c1"># This work is provided &quot;AS IS&quot; and subject to the ShotGrid Pipeline Toolkit</span>
<span class="c1"># Source Code License included in this distribution package. See LICENSE.</span>
<span class="c1"># By accessing, using, copying or modifying this work you indicate your</span>
<span class="c1"># agreement to the ShotGrid Pipeline Toolkit Source Code License. All rights</span>
<span class="c1"># not expressly granted therein are reserved by Autodesk, Inc.</span>

<span class="kn">import</span> <span class="nn">sgtk</span>
<span class="kn">from</span> <span class="nn">sgtk.platform.qt</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>

<span class="kn">from</span> <span class="nn">.list_view_auto_height</span> <span class="kn">import</span> <span class="n">ListViewAutoHeight</span>
<span class="kn">from</span> <span class="nn">.validation_details_widget</span> <span class="kn">import</span> <span class="n">ValidationDetailsWidget</span>
<span class="kn">from</span> <span class="nn">..api.data.validation_rule_type</span> <span class="kn">import</span> <span class="n">ValidationRuleType</span>
<span class="kn">from</span> <span class="nn">..api.data.validation_rule</span> <span class="kn">import</span> <span class="n">ValidationRule</span>
<span class="kn">from</span> <span class="nn">..models.validation_rule_model</span> <span class="kn">import</span> <span class="n">ValidationRuleModel</span>
<span class="kn">from</span> <span class="nn">..models.validation_rule_type_model</span> <span class="kn">import</span> <span class="n">ValidationRuleTypeModel</span>
<span class="kn">from</span> <span class="nn">..models.validation_rule_proxy_model</span> <span class="kn">import</span> <span class="n">ValidationRuleProxyModel</span>
<span class="kn">from</span> <span class="nn">.shotgrid_overlay_widget</span> <span class="kn">import</span> <span class="n">ShotGridOverlayWidget</span>
<span class="kn">from</span> <span class="nn">..utils.exceptions</span> <span class="kn">import</span> <span class="n">DataValidationError</span>
<span class="kn">from</span> <span class="nn">..utils.framework_qtwidgets</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FilterMenu</span><span class="p">,</span>
    <span class="n">FilterMenuButton</span><span class="p">,</span>
    <span class="n">GroupedItemView</span><span class="p">,</span>
    <span class="n">ViewItemDelegate</span><span class="p">,</span>
    <span class="n">ViewItemAction</span><span class="p">,</span>
    <span class="n">SearchWidget</span><span class="p">,</span>
    <span class="n">SGQToolButton</span><span class="p">,</span>
    <span class="n">SGQWidget</span><span class="p">,</span>
    <span class="n">SGQPushButton</span><span class="p">,</span>
    <span class="n">SGQSplitter</span><span class="p">,</span>
    <span class="n">SGQMenu</span><span class="p">,</span>
    <span class="n">SGQLabel</span><span class="p">,</span>
    <span class="n">SGQIcon</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">..utils.decorators</span> <span class="kn">import</span> <span class="n">wait_cursor</span>


<div class="viewcode-block" id="ValidationWidget"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget">[docs]</a><span class="k">class</span> <span class="nc">ValidationWidget</span><span class="p">(</span><span class="n">SGQWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The main widget for the Data Validation App.</span>

<span class="sd">    This widget displays the provided data validation rules, and provides the user interface to execute the</span>
<span class="sd">    rule check and fix functions. When data violations are found, a details widget will display the</span>
<span class="sd">    individual data items that violate the rules.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#</span>
    <span class="c1"># Settings keys to save and restore the widget properties</span>
    <span class="c1">#</span>
    <span class="n">SETTINGS_PREFIX</span> <span class="o">=</span> <span class="s2">&quot;ValidationWidget&quot;</span>
    <span class="n">SETTINGS_VIEW_MODE</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{prefix}</span><span class="s2">_view_mode&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">SETTINGS_PREFIX</span><span class="p">)</span>
    <span class="n">SETTINGS_SHOW_ONLY_ERRORS</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{prefix}</span><span class="s2">_show_only_errors&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="n">SETTINGS_PREFIX</span>
    <span class="p">)</span>
    <span class="n">SETTINGS_DETAILS_VISIBILITY</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{prefix}</span><span class="s2">_details_visibility&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="n">SETTINGS_PREFIX</span>
    <span class="p">)</span>
    <span class="n">SETTINGS_VIEW_DETAILS_SPLITTER_STATE</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{prefix}</span><span class="s2">_view_details_splitter_state&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">SETTINGS_PREFIX</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">SETTINGS_SELECTED_RULE_TYPE_ID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{prefix}</span><span class="s2">_selected_rule_type_id&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="n">SETTINGS_PREFIX</span>
    <span class="p">)</span>
    <span class="n">SETTINGS_FILTER_MENU_STATE</span> <span class="o">=</span> <span class="s2">&quot;filter_menu_state&quot;</span>

    <span class="c1">#</span>
    <span class="c1"># List of view modes</span>
    <span class="c1">#</span>
    <span class="p">(</span>
        <span class="n">VIEW_MODE_LIST</span><span class="p">,</span>
        <span class="n">VIEW_MODE_GROUPED</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Emit signals to indicate that the details widget is about to run an action, and when it has finished</span>
    <span class="c1"># (this is useful to # show a busy indicator, if the operation takes some time)</span>
    <span class="n">details_about_to_execute_action</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">details_execute_action_finished</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">group_rules_by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pre_validate_before_actions</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the validation widget.</span>

<span class="sd">        :param parent: The parent widget</span>
<span class="sd">        :type parent: QWidget</span>
<span class="sd">        :param group_rules_by: The validation rule field that the view will group rules by</span>
<span class="sd">        :type group_rules_by: str</span>
<span class="sd">        :param pre_validate_before_actions: True will run validation before executing actions</span>
<span class="sd">            so that the action callback acts on the most up to date error data. Default True. Default True.</span>
<span class="sd">        :type pre_validate_before_actions: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">ValidationWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">parent</span><span class="p">,</span> <span class="n">layout_direction</span><span class="o">=</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBoxLayout</span><span class="o">.</span><span class="n">TopToBottom</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bundle</span> <span class="o">=</span> <span class="n">sgtk</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">current_bundle</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VIEW_MODE_GROUPED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_details_on</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_type_filter_on</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group_rules_by</span> <span class="o">=</span> <span class="n">group_rules_by</span>

        <span class="c1"># Flag indicating if validate is run before actions to ensure actions are applied to</span>
        <span class="c1"># most up to date error data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_validate_before_actions</span> <span class="o">=</span> <span class="n">pre_validate_before_actions</span>

        <span class="c1"># Flag indicating whether or not eiether of the Valdiate or Fix All button have been clicked yet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validation_has_run</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Flag indicating that we&#39;re in the middle of validating all rules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_validating_all</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Custom callbacks for validate and fix all operations. See properties for more details.</span>
        <span class="c1"># The default methods to validate and fix all will be initialized. If a ValidationManager</span>
        <span class="c1"># is being used to manage the validation data, then override these callbacks with the</span>
        <span class="c1"># ValidationManager specific validate and fix functions.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_all_callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_rules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_rules_callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_rules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_all_callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_rules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_rules_callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_rules</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Set up the UI</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_models</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_ui</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connect_signals</span><span class="p">()</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Initialize the widget visibility</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">turn_on_rule_type_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rule_type_filter_on</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_details</span><span class="p">()</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Initialize the widget data</span>

        <span class="c1"># Set an empty data message until the it is initialized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_overlay_widget</span><span class="o">.</span><span class="n">show_message</span><span class="p">(</span><span class="s2">&quot;No validation data&quot;</span><span class="p">)</span>

    <span class="c1">#########################################################################################################</span>
    <span class="c1"># Properties</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">view_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get or set the current view mode.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode</span>

    <span class="nd">@view_mode</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">view_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_view_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">group_rules_by</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the field to group the validation rules by in the main view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_rules_by</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">validate_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the validate all button.</span>

<span class="sd">        This may be useful to disconnect the default callback for the fix all button clicked signal, to</span>
<span class="sd">        execute a custom validate all operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_button</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fix_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the fix all button.</span>

<span class="sd">        This may be useful to disconnect the default callback for the fix all button clicked signal, to</span>
<span class="sd">        execute a custom fix all operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_button</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">publish_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the publish button.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_publish_button</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">validate_rules_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set the custom callback triggered when the validate button is clicked.</span>

<span class="sd">        This property must be a function that accepts a single parameter that is a</span>
<span class="sd">        ValidationRule object or a list of ValidationRule objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_rules_callback</span>

    <span class="nd">@validate_rules_callback</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">validate_rules_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_rules_callback</span> <span class="o">=</span> <span class="n">cb</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">validate_all_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set the custom callback triggered when the validate button is clicked.</span>

<span class="sd">        This property must be a function that accepts a single parameter that is a list of ValidationRule</span>
<span class="sd">        objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_all_callback</span>

    <span class="nd">@validate_all_callback</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">validate_all_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_all_callback</span> <span class="o">=</span> <span class="n">cb</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fix_all_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set the custom callback triggered when the fix button is clicked.</span>

<span class="sd">        This property must be a function that accepts a single parameter that is a list of ValidationRule</span>
<span class="sd">        objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_all_callback</span>

    <span class="nd">@fix_all_callback</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">fix_all_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_all_callback</span> <span class="o">=</span> <span class="n">cb</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fix_rules_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set the custom callback triggered when the fix button is clicked.</span>

<span class="sd">        This property must be a function that accepts a single parameter that is a single</span>
<span class="sd">        ValiationRule object or a list of ValidationRule objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_rules_callback</span>

    <span class="nd">@fix_rules_callback</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">fix_rules_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_rules_callback</span> <span class="o">=</span> <span class="n">cb</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pre_validate_before_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set the property that decides if validation is ran before executing actions</span>
<span class="sd">        on the current affected (error) objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_validate_before_actions</span>

    <span class="nd">@pre_validate_before_actions</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pre_validate_before_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_validate</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_validate_before_actions</span> <span class="o">=</span> <span class="n">pre_validate</span>

    <span class="c1">#########################################################################################################</span>
    <span class="c1"># Public methods</span>

<div class="viewcode-block" id="ValidationWidget.save_state"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.save_state">[docs]</a>    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings_manager</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the widget state in the settings.</span>

<span class="sd">        :param settings_manager: The Toolkit settings object to save the widget settings to.</span>
<span class="sd">        :type settings_manager: UserSettings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SETTINGS_VIEW_MODE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode</span><span class="p">)</span>
        <span class="n">settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SETTINGS_SHOW_ONLY_ERRORS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors_toggle</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SETTINGS_DETAILS_VISIBILITY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">isVisible</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">rule_type_selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">rule_type_selected</span><span class="p">:</span>
            <span class="n">rule_type_selected</span> <span class="o">=</span> <span class="n">rule_type_selected</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rule_type_id</span> <span class="o">=</span> <span class="n">rule_type_selected</span><span class="o">.</span><span class="n">data</span><span class="p">(</span>
                <span class="n">ValidationRuleTypeModel</span><span class="o">.</span><span class="n">RULE_TYPE_ID_ROLE</span>
            <span class="p">)</span>
            <span class="n">settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SETTINGS_SELECTED_RULE_TYPE_ID</span><span class="p">,</span> <span class="n">rule_type_id</span><span class="p">)</span>

        <span class="c1"># SG Toolkit settings cannot handle byte arrays, so just save it in the QSettings objects</span>
        <span class="n">settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SETTINGS_VIEW_DETAILS_SPLITTER_STATE</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_view_details_splitter</span><span class="o">.</span><span class="n">saveState</span><span class="p">(),</span>
            <span class="n">pickle_setting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">settings_manager</span><span class="o">.</span><span class="n">store</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SETTINGS_FILTER_MENU_STATE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_menu</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ValidationWidget.restore_state"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.restore_state">[docs]</a>    <span class="k">def</span> <span class="nf">restore_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings_manager</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the widget state from the settings.</span>

<span class="sd">        :param settings_manager: The Toolkit settings object to restore the widget settings to.</span>
<span class="sd">        :type settings_manager: UserSettings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Restore the filter menu state</span>
        <span class="n">menu_state</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SETTINGS_FILTER_MENU_STATE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">menu_state</span><span class="p">:</span>
            <span class="n">menu_state</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;</span><span class="si">{role}</span><span class="s2">.data_type&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">):</span> <span class="p">{},</span>
                <span class="s2">&quot;</span><span class="si">{role}</span><span class="s2">.required&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">):</span> <span class="p">{},</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_menu</span><span class="o">.</span><span class="n">restore_state</span><span class="p">(</span><span class="n">menu_state</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">view_mode</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SETTINGS_VIEW_MODE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">VIEW_MODE_GROUPED</span>
        <span class="p">)</span>

        <span class="n">show_only_errors</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SETTINGS_SHOW_ONLY_ERRORS</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toggle_errors</span><span class="p">(</span><span class="n">show_only_errors</span><span class="p">)</span>

        <span class="n">show_details</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SETTINGS_DETAILS_VISIBILITY</span><span class="p">,</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_details</span><span class="p">(</span><span class="n">show_details</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rule_type_filter_on</span><span class="p">:</span>
            <span class="n">rule_type_id</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SETTINGS_SELECTED_RULE_TYPE_ID</span><span class="p">,</span>
                <span class="n">ValidationRuleType</span><span class="o">.</span><span class="n">RULE_TYPE_NONE</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">rule_type_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_model</span><span class="o">.</span><span class="n">get_item_for_rule_type</span><span class="p">(</span><span class="n">rule_type_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rule_type_item</span><span class="p">:</span>
                <span class="n">rule_type_index</span> <span class="o">=</span> <span class="n">rule_type_item</span><span class="o">.</span><span class="n">index</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rule_type_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="n">rule_type_index</span><span class="p">,</span>
                <span class="n">QtGui</span><span class="o">.</span><span class="n">QItemSelectionModel</span><span class="o">.</span><span class="n">ClearAndSelect</span>
                <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QItemSelectionModel</span><span class="o">.</span><span class="n">Current</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">splitter_state</span> <span class="o">=</span> <span class="n">settings_manager</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SETTINGS_VIEW_DETAILS_SPLITTER_STATE</span><span class="p">,</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_details_splitter</span><span class="o">.</span><span class="n">restoreState</span><span class="p">(</span><span class="n">splitter_state</span><span class="p">)</span>

        <span class="c1"># Must set the splitter collapsible property after the state is restored, or else this property is overwritten</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_details_splitter</span><span class="o">.</span><span class="n">setChildrenCollapsible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="ValidationWidget.turn_on_details"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.turn_on_details">[docs]</a>    <span class="k">def</span> <span class="nf">turn_on_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turn details on to show the right-hand side details panel widget.</span>

<span class="sd">        :param on: Set to True to turn on, or False to turn off.</span>
<span class="sd">        :type on: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_details_on</span> <span class="o">=</span> <span class="n">on</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_details_on</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_details_button</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_details_button</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_details_overlay_widget</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span></div>

<div class="viewcode-block" id="ValidationWidget.turn_on_rule_type_filter"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.turn_on_rule_type_filter">[docs]</a>    <span class="k">def</span> <span class="nf">turn_on_rule_type_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Turn rule type filter on to show the left-hand side filter widget.</span>

<span class="sd">        :param on: Set to True to turn on, or False to turn off.</span>
<span class="sd">        :type on: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_type_filter_on</span> <span class="o">=</span> <span class="n">on</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rule_type_filter_on</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_widget</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_widget</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span></div>

<div class="viewcode-block" id="ValidationWidget.set_validation_rules"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.set_validation_rules">[docs]</a>    <span class="k">def</span> <span class="nf">set_validation_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validation_rules</span><span class="p">,</span> <span class="n">validation_rule_types</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the validation rule types and data for the widget.</span>

<span class="sd">        This will reinitialize the validation rule models with the given data.</span>

<span class="sd">        :param validation_rules: The validation rules data</span>
<span class="sd">        :type validation_rules: list&lt;ValidationRule&gt;</span>
<span class="sd">        :param validation_rule_types: The type of validation rules to group the data by</span>
<span class="sd">        :type validation_rule_types: list&lt;ValidationRuleType&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rule_type_filter_on</span><span class="p">:</span>
            <span class="n">rule_types</span> <span class="o">=</span> <span class="n">validation_rule_types</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">rule_types</span><span class="p">:</span>
                <span class="c1"># Not rule types provied, extract the rule types from the data</span>
                <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">validation_rules</span><span class="p">:</span>
                    <span class="n">rule_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">rule_types</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_model</span><span class="o">.</span><span class="n">initialize_data</span><span class="p">(</span><span class="n">rule_types</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">initialize_data</span><span class="p">(</span><span class="n">validation_rules</span><span class="p">)</span></div>

<div class="viewcode-block" id="ValidationWidget.get_active_rules"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.get_active_rules">[docs]</a>    <span class="k">def</span> <span class="nf">get_active_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of the validation rules that are currently active.</span>

<span class="sd">        A validation rule is considered to be active if it is visible in the current view. Validation</span>
<span class="sd">        operations, like &quot;Validate&quot; and &quot;Fix All&quot;, may only be applied to active rules.</span>

<span class="sd">        :return: The list of validation rules.</span>
<span class="sd">        :rtype: list&lt;ValidationRule&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">src_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">sourceModel</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">proxy_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">proxy_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">proxy_row</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">src_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">mapToSource</span><span class="p">(</span><span class="n">proxy_index</span><span class="p">)</span>

            <span class="n">rule</span> <span class="o">=</span> <span class="n">src_index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rule</span><span class="p">:</span>
                <span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

            <span class="c1"># Check if the source index has children</span>
            <span class="n">src_model_item</span> <span class="o">=</span> <span class="n">src_model</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">src_index</span><span class="p">)</span>
            <span class="n">child_rows</span> <span class="o">=</span> <span class="n">src_model_item</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">child_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">child_rows</span><span class="p">):</span>
                <span class="n">child_item</span> <span class="o">=</span> <span class="n">src_model_item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">child_row</span><span class="p">)</span>
                <span class="c1"># Need to check that child is visible (proxy model has accepted it)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">filterAcceptsRow</span><span class="p">(</span><span class="n">child_row</span><span class="p">,</span> <span class="n">src_index</span><span class="p">):</span>
                    <span class="n">rule</span> <span class="o">=</span> <span class="n">child_item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">rule</span><span class="p">:</span>
                        <span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rules</span></div>

    <span class="c1">######################################################################################################</span>
    <span class="c1"># Protected methods</span>

    <span class="k">def</span> <span class="nf">_setup_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up the models for the widget.</span>

<span class="sd">        This should be called once when creating the widget, and it should be called before _setup_ui.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Rule types left-hand list (filter) navigation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_model</span> <span class="o">=</span> <span class="n">ValidationRuleTypeModel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Main validation rule source and proxy models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span> <span class="o">=</span> <span class="n">ValidationRuleModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_rules_by</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bundle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span> <span class="o">=</span> <span class="n">ValidationRuleProxyModel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">setSourceModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up the widget UI.</span>

<span class="sd">        This should be called once when creating the widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Main content</span>

        <span class="c1"># Create the left-hand list filter navigation</span>
        <span class="c1"># TODO allow the list filter to be configurable (not only by rule types)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span> <span class="o">=</span> <span class="n">ListViewAutoHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height_padding</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="o">.</span><span class="n">setMouseTracking</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">SingleSelection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="o">.</span><span class="n">group_items_selectable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_delegate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_rule_types_delegate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_widget</span> <span class="o">=</span> <span class="n">SGQWidget</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">layout_direction</span><span class="o">=</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBoxLayout</span><span class="o">.</span><span class="n">TopToBottom</span><span class="p">,</span>
            <span class="n">child_widgets</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># Create horizontal splitter for main view and details widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_details_splitter</span> <span class="o">=</span> <span class="n">SGQSplitter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_details_splitter</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span>
            <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_details_splitter</span><span class="o">.</span><span class="n">setOrientation</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span> <span class="o">=</span> <span class="n">GroupedItemView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view_details_splitter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CustomContextMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">setMouseTracking</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">group_items_selectable</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">SingleSelection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_delegate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_rules_delegate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_overlay_widget</span> <span class="o">=</span> <span class="n">ShotGridOverlayWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span> <span class="o">=</span> <span class="n">ValidationDetailsWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_view_details_splitter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_details_overlay_widget</span> <span class="o">=</span> <span class="n">ShotGridOverlayWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="p">)</span>

        <span class="c1"># Place the splitter in a container widget so that the left hand rule types widget and the splitter</span>
        <span class="c1"># widget vertically align</span>
        <span class="n">rules_widget</span> <span class="o">=</span> <span class="n">SGQWidget</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">layout_direction</span><span class="o">=</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBoxLayout</span><span class="o">.</span><span class="n">TopToBottom</span><span class="p">,</span>
            <span class="n">child_widgets</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_view_details_splitter</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># Create a layout for the main content and add the widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content_widget</span> <span class="o">=</span> <span class="n">SGQWidget</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">layout_direction</span><span class="o">=</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QBoxLayout</span><span class="o">.</span><span class="n">LeftToRight</span><span class="p">,</span>
            <span class="n">child_widgets</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_widget</span><span class="p">,</span> <span class="n">rules_widget</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Top toolbar</span>

        <span class="c1"># List view mode button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_list_button</span> <span class="o">=</span> <span class="n">SGQToolButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">SGQIcon</span><span class="o">.</span><span class="n">list_view_mode</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_list_button</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;view_mode_list_button&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_list_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Compact List View&quot;</span><span class="p">)</span>

        <span class="c1"># Grouped view mode button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_grouped_button</span> <span class="o">=</span> <span class="n">SGQToolButton</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">SGQIcon</span><span class="o">.</span><span class="n">grid_view_mode</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_grouped_button</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;view_mode_grouped_button&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_grouped_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Grouped View&quot;</span><span class="p">)</span>

        <span class="c1"># Error view mode button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors_toggle</span> <span class="o">=</span> <span class="n">SGQToolButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">SGQIcon</span><span class="o">.</span><span class="n">toggle</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors_toggle</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;errors_toggle&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors_toggle</span><span class="o">.</span><span class="n">setToolButtonStyle</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolButtonTextBesideIcon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors_toggle</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;  Only show validation errors&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors_toggle</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Toggle to see only validation errors.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors_toggle</span><span class="o">.</span><span class="n">setIconSize</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors_toggle</span><span class="o">.</span><span class="n">setCursor</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">PointingHandCursor</span><span class="p">)</span>

        <span class="c1"># Number of errors label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors_label</span> <span class="o">=</span> <span class="n">SGQLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Details button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_details_button</span> <span class="o">=</span> <span class="n">SGQToolButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="n">SGQIcon</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_details_button</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s2">&quot;Show/Hide Details Panel&quot;</span><span class="p">)</span>

        <span class="c1"># Filter text search bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_text_widget</span> <span class="o">=</span> <span class="n">SearchWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_text_widget</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>

        <span class="c1"># Filter menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_menu</span> <span class="o">=</span> <span class="n">FilterMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refresh_on_show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_menu</span><span class="o">.</span><span class="n">set_filter_roles</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_menu</span><span class="o">.</span><span class="n">set_accept_fields</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;</span><span class="si">{role}</span><span class="s2">.data_type&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">),</span>
                <span class="s2">&quot;</span><span class="si">{role}</span><span class="s2">.required&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_menu</span><span class="o">.</span><span class="n">set_filter_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="p">)</span>

        <span class="c1"># Filter menu button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_menu_button</span> <span class="o">=</span> <span class="n">FilterMenuButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_menu_button</span><span class="o">.</span><span class="n">setMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filter_menu</span><span class="p">)</span>

        <span class="c1"># Create the top toolbar layout and add all the widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toolbar_widget</span> <span class="o">=</span> <span class="n">SGQWidget</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">child_widgets</span><span class="o">=</span><span class="p">[</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_list_button</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_grouped_button</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_search_text_widget</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filter_menu_button</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_details_button</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Bottom toolbar</span>
        <span class="c1">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_button</span> <span class="o">=</span> <span class="n">SGQPushButton</span><span class="p">(</span><span class="s2">&quot;Validate&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_button</span> <span class="o">=</span> <span class="n">SGQPushButton</span><span class="p">(</span><span class="s2">&quot;Fix All&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_publish_button</span> <span class="o">=</span> <span class="n">SGQPushButton</span><span class="p">(</span><span class="s2">&quot;Ready to Publish&quot;</span><span class="p">)</span>

        <span class="c1"># Create the button layout and add the widgets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_footer_widget</span> <span class="o">=</span> <span class="n">SGQWidget</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">child_widgets</span><span class="o">=</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_errors_toggle</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_errors_label</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_button</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fix_button</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_publish_button</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Layouts and main widget</span>
        <span class="c1">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_toolbar_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_footer_widget</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_widgets</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_toolbar_widget</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_content_widget</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_footer_widget</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_signals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up and connect signal slots between widgets.</span>

<span class="sd">        This should be called once when creating the widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Button signals</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_list_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">checked</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_view_mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VIEW_MODE_LIST</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_grouped_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">checked</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_view_mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VIEW_MODE_GROUPED</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_details_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">checked</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_details</span><span class="p">(</span><span class="n">checked</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_errors_toggle</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">checked</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toggle_errors</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_text_widget</span><span class="o">.</span><span class="n">search_edited</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_search_text_changed</span><span class="p">)</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Rule types view signals</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_rule_type_selection_changed</span>
        <span class="p">)</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Rules view signals</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_rule_selection_changed</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_rule_item_context_menu_requested</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">doubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_rule_item_double_clicked</span><span class="p">)</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Rules types model signals</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_model</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="o">.</span><span class="n">updateGeometry</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_model</span><span class="o">.</span><span class="n">rule_type_check_state_changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_rule_type_check_state_changed</span>
        <span class="p">)</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Rules model signals</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">modelReset</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_rules_model_reset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">rule_check_state_changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_rule_check_state_changed</span>
        <span class="p">)</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Rules proxy model signals</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">layoutChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_rules_proxy_model_reset</span><span class="p">)</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Details widget signals</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">request_validate_data</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">rule</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_validate_rules</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">refresh_details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">request_fix_data</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_fix_rules</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">about_to_execute_action</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">details_about_to_execute_action</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">execute_action_finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">details_execute_action_finished</span>
        <span class="p">)</span>

        <span class="c1"># -----------------------------------------------------</span>
        <span class="c1"># Button clicked signals</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_validate_all</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_fix_all</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_rule_types_delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the delegate for the rule types view and set it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span>
        <span class="p">),</span> <span class="s2">&quot;The rules view must be created before the delegate&quot;</span>

        <span class="n">delegate</span> <span class="o">=</span> <span class="n">ViewItemDelegate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="p">)</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">text_padding</span> <span class="o">=</span> <span class="n">ViewItemDelegate</span><span class="o">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">item_padding</span> <span class="o">=</span> <span class="n">ViewItemDelegate</span><span class="o">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">separator_role</span> <span class="o">=</span> <span class="n">ValidationRuleTypeModel</span><span class="o">.</span><span class="n">VIEW_ITEM_SEPARATOR_ROLE</span>

        <span class="n">delegate</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ViewItemAction</span><span class="o">.</span><span class="n">TYPE_ICON</span><span class="p">,</span>
                <span class="s2">&quot;show_always&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;get_data&quot;</span><span class="p">:</span> <span class="n">get_rule_type_icon_data</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">ViewItemDelegate</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">add_actions</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ViewItemAction</span><span class="o">.</span><span class="n">TYPE_CHECK_BOX</span><span class="p">,</span>
                    <span class="s2">&quot;show_always&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;padding_right&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
                    <span class="s2">&quot;padding_top&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;padding_bottom&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;get_data&quot;</span><span class="p">:</span> <span class="n">get_rule_type_checkbox_data</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ViewItemAction</span><span class="o">.</span><span class="n">TYPE_ICON</span><span class="p">,</span>
                    <span class="s2">&quot;show_always&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;get_data&quot;</span><span class="p">:</span> <span class="n">get_rule_type_status_icon_data</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="n">ViewItemDelegate</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="o">.</span><span class="n">setItemDelegate</span><span class="p">(</span><span class="n">delegate</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delegate</span>

    <span class="k">def</span> <span class="nf">_create_rules_delegate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the delegate for the rules view and set it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="p">,</span> <span class="s2">&quot;The rules view must be created before the delegate&quot;</span>

        <span class="n">delegate</span> <span class="o">=</span> <span class="n">ViewItemDelegate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="p">)</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">text_rect_valign</span> <span class="o">=</span> <span class="n">ViewItemDelegate</span><span class="o">.</span><span class="n">CENTER</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">elide_text</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">elide_header</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">delegate</span><span class="o">.</span><span class="n">header_role</span> <span class="o">=</span> <span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">VIEW_ITEM_HEADER_ROLE</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">separator_role</span> <span class="o">=</span> <span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">VIEW_ITEM_SEPARATOR_ROLE</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">loading_role</span> <span class="o">=</span> <span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">VIEW_ITEM_LOADING_ROLE</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">height_role</span> <span class="o">=</span> <span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">VIEW_ITEM_HEIGHT_ROLE</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">expand_role</span> <span class="o">=</span> <span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">VIEW_ITEM_EXPAND_ROLE</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">text_role</span> <span class="o">=</span> <span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">VIEW_ITEM_TEXT_ROLE</span>

        <span class="n">delegate</span><span class="o">.</span><span class="n">add_action</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ViewItemAction</span><span class="o">.</span><span class="n">TYPE_PUSH_BUTTON</span><span class="p">,</span>
                <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="n">SGQIcon</span><span class="o">.</span><span class="n">tree_arrow</span><span class="p">(),</span>
                <span class="s2">&quot;show_always&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyleOptionButton</span><span class="o">.</span><span class="n">Flat</span><span class="p">,</span>
                <span class="s2">&quot;get_data&quot;</span><span class="p">:</span> <span class="n">get_expand_action_data</span><span class="p">,</span>
                <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">view</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">toggle_expand</span><span class="p">(</span><span class="n">index</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="n">ViewItemDelegate</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">add_actions</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ViewItemAction</span><span class="o">.</span><span class="n">TYPE_CHECK_BOX</span><span class="p">,</span>
                    <span class="s2">&quot;show_always&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;padding_top&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;padding_bottom&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;padding_right&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;get_data&quot;</span><span class="p">:</span> <span class="n">get_rule_optional_data</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ViewItemAction</span><span class="o">.</span><span class="n">TYPE_CHECK_BOX</span><span class="p">,</span>
                    <span class="s2">&quot;check_state_role&quot;</span><span class="p">:</span> <span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_MANUAL_CHECK_STATE_ROLE</span><span class="p">,</span>
                    <span class="s2">&quot;show_always&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;padding_top&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;padding_bottom&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;padding_right&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                    <span class="s2">&quot;get_data&quot;</span><span class="p">:</span> <span class="n">get_rule_manual_data</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ViewItemAction</span><span class="o">.</span><span class="n">TYPE_PUSH_BUTTON</span><span class="p">,</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;padding_left&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                    <span class="s2">&quot;padding_right&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                    <span class="s2">&quot;padding&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="s2">&quot;get_data&quot;</span><span class="p">:</span> <span class="n">get_rule_show_actions_data</span><span class="p">,</span>
                    <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule_show_actions_callback</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ViewItemAction</span><span class="o">.</span><span class="n">TYPE_PUSH_BUTTON</span><span class="p">,</span>
                    <span class="s2">&quot;padding&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="s2">&quot;get_data&quot;</span><span class="p">:</span> <span class="n">get_rule_fix_action_data</span><span class="p">,</span>
                    <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule_fix_action_callback</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ViewItemAction</span><span class="o">.</span><span class="n">TYPE_PUSH_BUTTON</span><span class="p">,</span>
                    <span class="s2">&quot;padding&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="s2">&quot;get_data&quot;</span><span class="p">:</span> <span class="n">get_rule_check_action_data</span><span class="p">,</span>
                    <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rule_check_action_callback</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="n">ViewItemDelegate</span><span class="o">.</span><span class="n">FLOAT_TOP_RIGHT</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">delegate</span><span class="o">.</span><span class="n">add_actions</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">ViewItemAction</span><span class="o">.</span><span class="n">TYPE_ICON</span><span class="p">,</span>
                    <span class="s2">&quot;icon_size&quot;</span><span class="p">:</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
                    <span class="s2">&quot;show_always&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;padding&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="s2">&quot;get_data&quot;</span><span class="p">:</span> <span class="n">get_rule_status_action_data</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="n">ViewItemDelegate</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">setItemDelegate</span><span class="p">(</span><span class="n">delegate</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delegate</span>

    <span class="k">def</span> <span class="nf">_set_view_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view_mode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the current view mode for the main validation rules view.</span>

<span class="sd">        :param view_mode: The view mode (id) to set</span>
<span class="sd">            Supported view modes:</span>
<span class="sd">                VIEW_MODE_LIST - a flat list view</span>
<span class="sd">                VIEW_MODE_GROUPED - a grouped list view</span>
<span class="sd">        :type view_mode: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode</span> <span class="o">=</span> <span class="n">view_mode</span>

        <span class="k">if</span> <span class="n">view_mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">VIEW_MODE_LIST</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_list_button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_grouped_button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">hierarchical</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">group_spacing</span> <span class="o">=</span> <span class="mi">30</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">show_description</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_rules_delegate</span><span class="o">.</span><span class="n">text_padding</span> <span class="o">=</span> <span class="n">ViewItemDelegate</span><span class="o">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rules_delegate</span><span class="o">.</span><span class="n">action_item_margin</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rules_delegate</span><span class="o">.</span><span class="n">visible_lines</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">view_mode</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">VIEW_MODE_GROUPED</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_grouped_button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_view_mode_list_button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">hierarchical</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">group_spacing</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">show_description</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_rules_delegate</span><span class="o">.</span><span class="n">visible_lines</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rules_delegate</span><span class="o">.</span><span class="n">text_padding</span> <span class="o">=</span> <span class="n">ViewItemDelegate</span><span class="o">.</span><span class="n">Padding</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rules_delegate</span><span class="o">.</span><span class="n">action_item_margin</span> <span class="o">=</span> <span class="mi">7</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;Unsupported view mode&quot;</span>

    <span class="k">def</span> <span class="nf">_show_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the details widget visibility and update the widget according to the current selection.</span>

<span class="sd">        If the details functionality is turned off, nothing will happen.</span>

<span class="sd">        :param show: True will show the details, else False will hide it. If None, the details visibility</span>
<span class="sd">            will be toggled based on the current visibility state. Default=None</span>
<span class="sd">        :type show: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_details_on</span><span class="p">:</span>
            <span class="c1"># The details widget is not available</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">show</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Toggle the visibility</span>
            <span class="n">show</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_details_button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Set the visibility explicitly</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_details_button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">show</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="n">show</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_details</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected_indexes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the details widget with the current seleciton.</span>

<span class="sd">        :param selected_indexes: The selected indexes to update the widget with</span>
<span class="sd">        :type selected_indexes: list&lt;QtGui.QModelIndex&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">selected_indexes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_details_overlay_widget</span><span class="o">.</span><span class="n">show_message</span><span class="p">(</span>
                <span class="s2">&quot;Select a Validation Rule to see more details.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_indexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_details_overlay_widget</span><span class="o">.</span><span class="n">show_message</span><span class="p">(</span>
                <span class="s2">&quot;Select a Validation Rule to see details.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_details_overlay_widget</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
            <span class="n">model_index</span> <span class="o">=</span> <span class="n">selected_indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="n">model_index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">rule</span><span class="p">:</span>
                <span class="c1"># Do not show details for group items</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_details_overlay_widget</span><span class="o">.</span><span class="n">show_message</span><span class="p">(</span>
                    <span class="s2">&quot;Select a Validation Rule to see more details.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_refresh_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh the details widget to reflect the latest changes to the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_details_on</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">isVisible</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="n">rule</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">rule</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">rule</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">rule</span><span class="o">.</span><span class="n">id</span>
        <span class="p">):</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the errors label text to indicated how many errors ther are currently.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">num_errors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">get_errors</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">num_errors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_errors_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> issue</span><span class="si">{}</span><span class="s2"> found    &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_errors</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span> <span class="k">if</span> <span class="n">num_errors</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_errors_label</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_errors_label</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_show_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">indexes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show a context menu for the selected items.</span>

<span class="sd">        :param widget: The source widget.</span>
<span class="sd">        :type widget: QtGui.QWidget</span>
<span class="sd">        :param pos: The position for the context menu relative to the source widget.</span>
<span class="sd">        :type pos: QtCore.QPoint</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="n">selection_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">selection_model</span><span class="p">:</span>
                <span class="n">indexes</span> <span class="o">=</span> <span class="n">selection_model</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>

        <span class="c1"># A single index must be selected</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">indexes</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Get the actions for this index</span>
        <span class="n">src_index</span> <span class="o">=</span> <span class="n">_ensure_source_index</span><span class="p">(</span><span class="n">indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rule_model_item</span> <span class="o">=</span> <span class="n">src_index</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">itemFromIndex</span><span class="p">(</span><span class="n">src_index</span><span class="p">)</span>
        <span class="n">rule_actions</span> <span class="o">=</span> <span class="n">rule_model_item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ACTIONS_ROLE</span><span class="p">)</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rule_action</span> <span class="ow">in</span> <span class="n">rule_actions</span><span class="p">:</span>
            <span class="n">callback</span> <span class="o">=</span> <span class="n">rule_action</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;callback&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">callback</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">rule</span> <span class="o">=</span> <span class="n">rule_model_item</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">rule_action</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;kwargs&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">rule</span><span class="o">.</span><span class="n">get_errors</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_validate_before_actions</span> <span class="k">else</span> <span class="n">rule</span><span class="o">.</span><span class="n">errors</span>
            <span class="p">)</span>

            <span class="n">action</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="n">rule_action</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fn</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">fn</span><span class="p">(</span><span class="o">**</span><span class="n">k</span><span class="p">))</span>
            <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="c1"># Add action to show details for the item that the context menu is shown for.</span>
        <span class="n">is_details_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_details_widget</span><span class="o">.</span><span class="n">isVisible</span><span class="p">()</span>
        <span class="n">toggle_details_action</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span>
            <span class="s2">&quot;Hide Details&quot;</span> <span class="k">if</span> <span class="n">is_details_visible</span> <span class="k">else</span> <span class="s2">&quot;Show Details&quot;</span>
        <span class="p">)</span>
        <span class="n">toggle_details_action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_details</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="ow">not</span> <span class="n">is_details_visible</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toggle_details_action</span><span class="p">)</span>

        <span class="c1"># Create the menu, add the actions and show it</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">SGQMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">addActions</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="nd">@sgtk</span><span class="o">.</span><span class="n">LogManager</span><span class="o">.</span><span class="n">log_timing</span>
    <span class="k">def</span> <span class="nf">_validate_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">,</span> <span class="n">refresh_details</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The default validate operation that executes the validate function for each of the rules.</span>

<span class="sd">        :param rules: The list of rules, or single rule, to validate.</span>
<span class="sd">        :type rules: list&lt;ValidationRule&gt; | ValidationRule</span>
<span class="sd">        :param refresh_details: Set to True to refresh the details widget after the validation.</span>
<span class="sd">        :type refresh_details: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bundle</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Validating Rule: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_rule_begin</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="n">rule</span><span class="o">.</span><span class="n">exec_check</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_rule_finished</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">update_rule_type</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">refresh_details</span><span class="p">:</span>
            <span class="c1"># Refresh the details since its data may have changed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_details</span><span class="p">()</span>

    <span class="nd">@sgtk</span><span class="o">.</span><span class="n">LogManager</span><span class="o">.</span><span class="n">log_timing</span>
    <span class="k">def</span> <span class="nf">_fix_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The default fix operation that executes the fix function for each of the rules.</span>

<span class="sd">        NOTE this default fix operation does not take into account rule dependencies. Rules will be executed</span>
<span class="sd">        in the order as they appear in the model. Use the ValidationManager to implement rule resolution order</span>
<span class="sd">        based on dependenceis.</span>

<span class="sd">        :param rules: The list of rules to validate.</span>
<span class="sd">        :type rules: list&lt;ValidationRule&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bundle</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Resolving Rule: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fix_rule_begin</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="n">rule</span><span class="o">.</span><span class="n">exec_fix</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fix_rule_finished</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_view_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the main rules view overlay widget.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_view_overlay_widget</span><span class="o">.</span><span class="n">show_message</span><span class="p">(</span><span class="s2">&quot;No data.&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># There are no results showing, display an overlay message</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">details_text</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_errors_toggle</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="c1"># Showing only errors</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validation_has_run</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Click Validate or Fix All to start.&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">num_errors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">get_errors</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">num_errors</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">icon</span> <span class="o">=</span> <span class="n">SGQIcon</span><span class="o">.</span><span class="n">validation_ok</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">SGQIcon</span><span class="o">.</span><span class="n">SIZE_40x40</span><span class="p">)</span>
                        <span class="n">details_text</span> <span class="o">=</span> <span class="s2">&quot;&lt;br/&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="s2">&quot;&lt;span style=&#39;font-size:24px; color:#309AFF;&#39;&gt;Awesome work!&lt;/span&gt;&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;&lt;span style=&#39;font-size:14px;&#39;&gt;Success! No errors found. You&#39;re ready to publish.&lt;/span&gt;&quot;</span><span class="p">,</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># There are errors but they are hidden by the current filters.</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;No results. Clear filters to view data.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Showing all data</span>
                <span class="c1"># The current filters must be hiding everything.</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;No results. Clear filters to view data.&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_view_overlay_widget</span><span class="o">.</span><span class="n">show_message</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">icon</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="n">details_text</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_view_overlay_widget</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

    <span class="c1">######################################################################################################</span>
    <span class="c1"># Callback methods</span>

<div class="viewcode-block" id="ValidationWidget.on_validate_all"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.on_validate_all">[docs]</a>    <span class="nd">@wait_cursor</span>
    <span class="k">def</span> <span class="nf">on_validate_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered when the validation all button has been triggered.</span>

<span class="sd">        If the custom validate all callback is set, then get all rules from the model to resolve and pass it</span>
<span class="sd">        to the custom callback, else call the default validate all operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_all_begin</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">active_rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_rules</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_all_callback</span><span class="p">(</span><span class="n">active_rules</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_all_finished</span><span class="p">()</span></div>

<div class="viewcode-block" id="ValidationWidget.on_fix_all"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.on_fix_all">[docs]</a>    <span class="nd">@wait_cursor</span>
    <span class="k">def</span> <span class="nf">on_fix_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered when the fix all button has been triggered.</span>

<span class="sd">        If the custom fix all callback is set, then get all rules from the model to resolve and pass it to</span>
<span class="sd">        the custom callback, else call the default fix all operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">active_rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_rules</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix_all_callback</span><span class="p">(</span><span class="n">active_rules</span><span class="p">)</span></div>

<div class="viewcode-block" id="ValidationWidget.on_validate_rules"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.on_validate_rules">[docs]</a>    <span class="nd">@wait_cursor</span>
    <span class="k">def</span> <span class="nf">on_validate_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">,</span> <span class="n">refresh_details</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered to validate a specific set of rules.</span>

<span class="sd">        :param rule: The validation rule or list of rules to validate.</span>
<span class="sd">        :type rule: VaildationRule | list&lt;ValidationRule&gt;</span>
<span class="sd">        :param refresh_details: Set to True to refresh the details widget after validation.</span>
<span class="sd">        :type refresh_details: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">ValidationRule</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">DataValidationError</span><span class="p">(</span>
                <span class="s2">&quot;Rules passed to validate must be a list or tuple.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_rules_callback</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataValidationError</span><span class="p">(</span><span class="s2">&quot;Validation rules callback not defined.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_rules_callback</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">refresh_details</span><span class="p">:</span>
            <span class="c1"># Refresh the details since its data may have changed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_details</span><span class="p">()</span></div>

<div class="viewcode-block" id="ValidationWidget.on_fix_rules"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.on_fix_rules">[docs]</a>    <span class="nd">@wait_cursor</span>
    <span class="k">def</span> <span class="nf">on_fix_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered to fix a specific set of rules.</span>

<span class="sd">        :param rule: The validation rule or list of rules to fix.</span>
<span class="sd">        :type rule: VaildationRule | list&lt;ValidationRule&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">ValidationRule</span><span class="p">):</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">rules</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">DataValidationError</span><span class="p">(</span><span class="s2">&quot;Rules passed to fix must be a list or tuple.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fix_rules_callback</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DataValidationError</span><span class="p">(</span><span class="s2">&quot;Fix rules callback not defined.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fix_rules_callback</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></div>

<div class="viewcode-block" id="ValidationWidget.validate_rule_begin"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.validate_rule_begin">[docs]</a>    <span class="k">def</span> <span class="nf">validate_rule_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this method before a validaiton rule is check function is executed.</span>

<span class="sd">        :param rule: The rule that is about to start executing its check function.</span>
<span class="sd">        :type rule: ValidationRule</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rule</span><span class="p">:</span>
            <span class="k">return</span></div>

        <span class="c1"># TODO any specific actions before begin check (ie. set loading)</span>
        <span class="c1"># rule_item = self._rules_model.get_item_for_rule(rule)</span>

<div class="viewcode-block" id="ValidationWidget.validate_rule_finished"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.validate_rule_finished">[docs]</a>    <span class="k">def</span> <span class="nf">validate_rule_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">update_rule_type</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this method after a validation rule check function has finished executing.</span>

<span class="sd">        :param rule: The rule that finished executing its check function.</span>
<span class="sd">        :type rule: ValidationRule</span>
<span class="sd">        :param update_rule_type: True will update the rule type model data based on the updated rule.</span>
<span class="sd">        :type update_rule_type: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rule</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_validating_all</span><span class="p">:</span>
            <span class="c1"># Do not process the individual rule after validation if there is not rule, or all rules are</span>
            <span class="c1"># being validated at once</span>
            <span class="k">return</span>

        <span class="n">rule_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">get_item_for_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rule_item</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">updated</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">update_rule_type</span><span class="p">:</span>
            <span class="c1"># Update the rule type status corresponding to the updated rule</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">get_status_for_rule_type</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="n">rule_type_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_model</span><span class="o">.</span><span class="n">get_item_for_rule_type</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rule_type_index</span><span class="p">:</span>
                <span class="n">rule_type_index</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span>
                    <span class="n">status</span><span class="p">,</span> <span class="n">ValidationRuleTypeModel</span><span class="o">.</span><span class="n">RULE_TYPE_STATUS_ROLE</span>
                <span class="p">)</span>
                <span class="n">updated</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">updated</span><span class="p">:</span>
            <span class="n">rule_item</span><span class="o">.</span><span class="n">emitDataChanged</span><span class="p">()</span>

        <span class="c1"># Update the proxy model to reflect any changes after validation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="c1"># Update the errors label to reflect any changes after validation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_errors</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_details</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span></div>

<div class="viewcode-block" id="ValidationWidget.validate_all_begin"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.validate_all_begin">[docs]</a>    <span class="k">def</span> <span class="nf">validate_all_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this method before all validation rules are checked.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_validating_all</span><span class="p">:</span>
            <span class="c1"># Already validating</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_validating_all</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ValidationWidget.validate_all_finished"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.validate_all_finished">[docs]</a>    <span class="k">def</span> <span class="nf">validate_all_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this method after all validation rules have been checked.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_validating_all</span><span class="p">:</span>
            <span class="c1"># Nothing to do, if validation did not happen.</span>
            <span class="k">return</span>

        <span class="c1"># Get and update the rule type statuses</span>
        <span class="p">(</span>
            <span class="n">valid</span><span class="p">,</span>
            <span class="n">errors</span><span class="p">,</span>
            <span class="n">incomplete</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">get_statuses_for_rule_type</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_model</span><span class="o">.</span><span class="n">set_statuses</span><span class="p">(</span><span class="n">valid</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">incomplete</span><span class="p">)</span>

        <span class="c1"># Update the flags around validation before emitting/triggering any signals/slots, in</span>
        <span class="c1"># case they rely on these flags being updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validation_has_run</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_validating_all</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Emit signal that validation rules have been updated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">emit_all_data_changed</span><span class="p">()</span>

        <span class="c1"># Update the proxy model to reflect any changes after validation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>

        <span class="c1"># Update the errors label to reflect any changes after validation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_errors</span><span class="p">()</span>

        <span class="c1"># Ensure the details is refreshed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_details</span><span class="p">()</span></div>

<div class="viewcode-block" id="ValidationWidget.fix_rule_begin"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.fix_rule_begin">[docs]</a>    <span class="k">def</span> <span class="nf">fix_rule_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this method before a validaiton rule is fix function is executed.</span>

<span class="sd">        :param rule: The rule that is about to start executing its fix function.</span>
<span class="sd">        :type rule: ValidationRule</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rule</span><span class="p">:</span>
            <span class="k">return</span></div>

        <span class="c1"># TODO any specific actions before begin check (ie. set loading)</span>
        <span class="c1"># rule_item = self._rules_model.get_item_for_rule(rule)</span>

<div class="viewcode-block" id="ValidationWidget.fix_rule_finished"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.fix_rule_finished">[docs]</a>    <span class="k">def</span> <span class="nf">fix_rule_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this method after a validation rule fix function has finished executing.</span>

<span class="sd">        :param rule: The rule that finished executing its fix function.</span>
<span class="sd">        :type rule: ValidationRule</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rule</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">rule_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">get_item_for_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rule_item</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># The rule data may have changed, emit the data changed signal to indicate rule data updates.</span>
        <span class="n">rule_item</span><span class="o">.</span><span class="n">emitDataChanged</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_on_rule_item_context_menu_requested</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered when a rule from the view has been right-clicked.</span>

<span class="sd">        :param pos: The mouse position, relative to the sender (widget), captured when triggering this</span>
<span class="sd">            callback.</span>
<span class="sd">        :type pos: QtCore.QPoint</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_show_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">(),</span> <span class="n">pos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_rule_item_double_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered when a rule from the view has been double-clicked.</span>

<span class="sd">        :param index: The index the mouse double-clicked on.</span>
<span class="sd">        :type index: QModelIndex</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rule</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_validate_rules</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">refresh_details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_search_text_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered when the search widget text has been updated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">search_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_text_widget</span><span class="o">.</span><span class="n">_get_search_text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">set_text_filter_value</span><span class="p">(</span>
            <span class="n">search_text</span><span class="p">,</span> <span class="n">data_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules_delegate</span><span class="o">.</span><span class="n">get_displayed_text</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_rules_model_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered when the rules model has been reset.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view_overlay</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_menu</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_rules_proxy_model_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered when the rules proxy model has been reset.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view_overlay</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_rule_check_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">check_state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered when a rule has been checked.</span>

<span class="sd">        When a rule is checked, this will affect the data of the rule types model.</span>

<span class="sd">        :param rule: The valudaiton rule whose check state changed</span>
<span class="sd">        :type rule: ValidationRule</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Update the rule types model data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_model</span><span class="o">.</span><span class="n">set_check_state_for_rule_type</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">check_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_rule_type_check_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_type</span><span class="p">,</span> <span class="n">check_state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered when a rule type has been checked.</span>

<span class="sd">        When a rule type is checked, thsi will affect the data of the rules model.</span>

<span class="sd">        :param rule_type: The validation rule type whose check state changed</span>
<span class="sd">        :type rule_type: ValidationRuleType</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">rule_type</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">ValidationRuleType</span><span class="o">.</span><span class="n">RULE_TYPE_MANUAL</span><span class="p">:</span>
            <span class="n">check_state_role</span> <span class="o">=</span> <span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_MANUAL_CHECK_STATE_ROLE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">check_state_role</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_model</span><span class="o">.</span><span class="n">set_check_state_for_rule_type</span><span class="p">(</span>
            <span class="n">rule_type</span><span class="p">,</span> <span class="n">check_state</span><span class="p">,</span> <span class="n">check_state_role</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_rule_type_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered when the rule type selection has changed.</span>

<span class="sd">        The rules list will be updated to reflect the current rule type selection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rule_types_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Only single selection</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Get the value to filter the rule type by</span>
        <span class="n">rule_type</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleTypeModel</span><span class="o">.</span><span class="n">RULE_TYPE_ROLE</span><span class="p">)</span>

        <span class="c1"># Filter the rules view by the selected rule type</span>
        <span class="k">if</span> <span class="n">rule_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rule_type</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">ValidationRuleType</span><span class="o">.</span><span class="n">RULE_TYPE_NONE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">remove_rule_type_filter</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">set_rule_type</span><span class="p">(</span>
                <span class="n">rule_type</span><span class="p">,</span>
                <span class="n">filter_role</span><span class="o">=</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_rule_selection_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered when the rule selection has chagned.</span>

<span class="sd">        The details widget will be updated to reflect the current rule selection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">selectedIndexes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_details</span><span class="p">(</span><span class="n">indexes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_toggle_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_errors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback triggered to show only the validation rules with errors.</span>

<span class="sd">        :param show_errors: Set to True to show only errors, False to show all, and None to toggle the current state.</span>
<span class="sd">        :type show_errors: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">show_errors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_errors_toggle</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">show_errors</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_proxy_model</span><span class="o">.</span><span class="n">turn_on_error_filter</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="n">show_errors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filter_menu</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

    <span class="c1">######################################################################################################</span>
    <span class="c1"># ViewItemDelegate callback functions</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="ValidationWidget.rule_show_actions_callback"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.rule_show_actions_callback">[docs]</a>    <span class="k">def</span> <span class="nf">rule_show_actions_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The validation rule action to show the list of action items was triggered.</span>

<span class="sd">        :param view: The view the index belongs to.</span>
<span class="sd">        :type view: QAbstractItemView</span>
<span class="sd">        :param index: The index to act on</span>
<span class="sd">        :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>
<span class="sd">        :param pos: The mouse position captured on triggered this callback</span>
<span class="sd">        :type pos: :class:`sgtk.platform.qt.QtCore.QPoint`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># First select the index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">index</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QItemSelectionModel</span><span class="o">.</span><span class="n">ClearAndSelect</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_show_context_menu</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="p">[</span><span class="n">index</span><span class="p">])</span></div>

<div class="viewcode-block" id="ValidationWidget.rule_check_action_callback"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.rule_check_action_callback">[docs]</a>    <span class="nd">@wait_cursor</span>
    <span class="k">def</span> <span class="nf">rule_check_action_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The validation rule action to execute the rule check function was triggered.</span>

<span class="sd">        :param view: The view the index belongs to.</span>
<span class="sd">        :type view: QAbstractItemView</span>
<span class="sd">        :param index: The index to act on</span>
<span class="sd">        :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>
<span class="sd">        :param pos: The mouse position captured on triggered this callback</span>
<span class="sd">        :type pos: :class:`sgtk.platform.qt.QtCore.QPoint`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># First select the index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">index</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QItemSelectionModel</span><span class="o">.</span><span class="n">ClearAndSelect</span>
        <span class="p">)</span>

        <span class="c1"># Get the ValidationRule objects for the index</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">)</span> <span class="ow">or</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span>
            <span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEMS_ROLE</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">on_validate_rules</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span> <span class="n">refresh_details</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="ValidationWidget.rule_fix_action_callback"><a class="viewcode-back" href="../../../api.html#tk_multi_data_validation.widgets.ValidationWidget.rule_fix_action_callback">[docs]</a>    <span class="nd">@wait_cursor</span>
    <span class="k">def</span> <span class="nf">rule_fix_action_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The validation rule action to execute the rule fix function was triggered.</span>

<span class="sd">        :param view: The view the index belongs to.</span>
<span class="sd">        :type view: QAbstractItemView</span>
<span class="sd">        :param index: The index to act on</span>
<span class="sd">        :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>
<span class="sd">        :param pos: The mouse position captured on triggered this callback</span>
<span class="sd">        :type pos: :class:`sgtk.platform.qt.QtCore.QPoint`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># First select the index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules_view</span><span class="o">.</span><span class="n">selectionModel</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">index</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QItemSelectionModel</span><span class="o">.</span><span class="n">ClearAndSelect</span>
        <span class="p">)</span>

        <span class="c1"># Get the ValidationRule object for the index</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">)</span> <span class="ow">or</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span>
            <span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEMS_ROLE</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">on_fix_rules</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span></div></div>


<span class="c1">#############################################################################################################</span>
<span class="c1"># ViewItemDelegate callback functions (independent of the ValidationWidget class)</span>
<span class="c1">#</span>


<span class="k">def</span> <span class="nf">get_expand_action_data</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback function triggered by the ViewItemDelegate.</span>

<span class="sd">    Get the data for displaying the rule group header expand action.</span>

<span class="sd">    :param parent: The parent of the ViewItemDelegate which triggered this callback</span>
<span class="sd">    :type parent: QAbstractItemView</span>
<span class="sd">    :param index: The index the action is for.</span>
<span class="sd">    :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>

<span class="sd">    :return: The data for the action and index.</span>
<span class="sd">    :rtype: dict (see the ViewItemAction class attribute `get_data` for more details)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">visible</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">IS_GROUP_ITEM_ROLE</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_Active</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_Enabled</span>

    <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">is_expanded</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">|=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_Off</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">|=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_On</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">get_rule_type_icon_data</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback function triggered by the ViewItemDelegate.</span>

<span class="sd">    Get the data for displaying the rule type icon.</span>

<span class="sd">    :param parent: The parent of the ViewItemDelegate which triggered this callback</span>
<span class="sd">    :type parent: QAbstractItemView</span>
<span class="sd">    :param index: The index the action is for.</span>
<span class="sd">    :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>

<span class="sd">    :return: The data for the action and index.</span>
<span class="sd">    :rtype: dict (see the ViewItemAction class attribute `get_data` for more details)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">icon</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleTypeModel</span><span class="o">.</span><span class="n">RULE_TYPE_ICON_ROLE</span><span class="p">)</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span> <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="n">icon</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">get_rule_type_status_icon_data</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback function triggered by the ViewItemDelegate.</span>

<span class="sd">    Get the data for displaying the rule type status.</span>

<span class="sd">    :param parent: The parent of the ViewItemDelegate which triggered this callback</span>
<span class="sd">    :type parent: QAbstractItemView</span>
<span class="sd">    :param index: The index the action is for.</span>
<span class="sd">    :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>

<span class="sd">    :return: The data for the action and index.</span>
<span class="sd">    :rtype: dict (see the ViewItemAction class attribute `get_data` for more details)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">icon</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleTypeModel</span><span class="o">.</span><span class="n">RULE_TYPE_STATUS_ICON_ROLE</span><span class="p">)</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span> <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="n">icon</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">get_rule_type_checkbox_data</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback function triggered by the ViewItemDelegate.</span>

<span class="sd">    Get the data for displaying the rule type checkbox widget.</span>

<span class="sd">    :param parent: The parent of the ViewItemDelegate which triggered this callback</span>
<span class="sd">    :type parent: QAbstractItemView</span>
<span class="sd">    :param index: The index the action is for.</span>
<span class="sd">    :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>

<span class="sd">    :return: The data for the action and index.</span>
<span class="sd">    :rtype: dict (see the ViewItemAction class attribute `get_data` for more details)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rule_type_id</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleTypeModel</span><span class="o">.</span><span class="n">RULE_TYPE_ID_ROLE</span><span class="p">)</span>
    <span class="n">checkbox_state</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">)</span>
    <span class="n">icon</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleTypeModel</span><span class="o">.</span><span class="n">CHECKBOX_ICON_ROLE</span><span class="p">)</span>

    <span class="c1"># This action is &quot;visible&quot; for all to align actions in each row, but for rule types that this</span>
    <span class="c1"># action does not apply to, it will be hidden (but take up the space)</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">applicable</span> <span class="o">=</span> <span class="n">rule_type_id</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="n">ValidationRuleType</span><span class="o">.</span><span class="n">RULE_TYPE_MANUAL</span><span class="p">,</span>
        <span class="n">ValidationRuleType</span><span class="o">.</span><span class="n">RULE_TYPE_OPTIONAL</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_Active</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_Enabled</span>
    <span class="k">if</span> <span class="n">checkbox_state</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">|=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_On</span>
    <span class="k">elif</span> <span class="n">checkbox_state</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">PartiallyChecked</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">icon</span><span class="p">:</span>
            <span class="c1"># Icons cannot have a partial check state - set the state to be on</span>
            <span class="n">state</span> <span class="o">|=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_On</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">|=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_NoChange</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">|=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_Off</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
        <span class="s2">&quot;placeholder&quot;</span><span class="p">:</span> <span class="ow">not</span> <span class="n">applicable</span><span class="p">,</span>
        <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
        <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="n">icon</span><span class="p">,</span>
        <span class="s2">&quot;padding_right&quot;</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">icon</span> <span class="k">else</span> <span class="mi">14</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">get_rule_manual_data</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback function triggered by the ViewItemDelegate.</span>

<span class="sd">    Get the data for displaying a manual rule.</span>

<span class="sd">    :param parent: The parent of the ViewItemDelegate which triggered this callback</span>
<span class="sd">    :type parent: QAbstractItemView</span>
<span class="sd">    :param index: The index the action is for.</span>
<span class="sd">    :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>

<span class="sd">    :return: The data for the action and index.</span>
<span class="sd">    :rtype: dict (see the ViewItemAction class attribute `get_data` for more details)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rule</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rule</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">rule</span><span class="o">.</span><span class="n">manual</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

    <span class="n">checkbox_state</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_MANUAL_CHECK_STATE_ROLE</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_Active</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_Enabled</span>

    <span class="k">if</span> <span class="n">checkbox_state</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">|=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_On</span>
    <span class="k">elif</span> <span class="n">checkbox_state</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">PartiallyChecked</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">|=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_NoChange</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">|=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_Off</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">get_rule_optional_data</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback function triggered by the ViewItemDelegate.</span>

<span class="sd">    Get the data for displaying an optional rule.</span>

<span class="sd">    :param parent: The parent of the ViewItemDelegate which triggered this callback</span>
<span class="sd">    :type parent: QAbstractItemView</span>
<span class="sd">    :param index: The index the action is for.</span>
<span class="sd">    :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>

<span class="sd">    :return: The data for the action and index.</span>
<span class="sd">    :rtype: dict (see the ViewItemAction class attribute `get_data` for more details)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rule</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEM_ROLE</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rule</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">rule</span><span class="o">.</span><span class="n">optional</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">manual</span><span class="p">:</span>
            <span class="c1"># Ensure the manual checkboxes are aligned across rows</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;placeholder&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;padding_left&quot;</span><span class="p">:</span> <span class="mi">22</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

    <span class="n">checkbox_icon</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">CHECKBOX_ICON_ROLE</span><span class="p">)</span>
    <span class="n">checkbox_state</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_Active</span> <span class="o">|</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_Enabled</span>

    <span class="k">if</span> <span class="n">checkbox_state</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">|=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_On</span>
    <span class="k">elif</span> <span class="n">checkbox_state</span> <span class="o">==</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">PartiallyChecked</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">|=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_NoChange</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">|=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QStyle</span><span class="o">.</span><span class="n">State_Off</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
        <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="n">checkbox_icon</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">get_rule_show_actions_data</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback function triggered by the ViewItemDelegate.</span>

<span class="sd">    Get the data for displaying and executing the rule action items.</span>

<span class="sd">    :param parent: The parent of the ViewItemDelegate which triggered this callback</span>
<span class="sd">    :type parent: QAbstractItemView</span>
<span class="sd">    :param index: The index the action is for.</span>
<span class="sd">    :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>

<span class="sd">    :return: The data for the action and index.</span>
<span class="sd">    :rtype: dict (see the ViewItemAction class attribute `get_data` for more details)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">visible</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ACTIONS_ROLE</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">get_rule_check_action_data</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback function triggered by the ViewItemDelegate.</span>

<span class="sd">    Get the data for displaying and executing the rule check action.</span>

<span class="sd">    :param parent: The parent of the ViewItemDelegate which triggered this callback</span>
<span class="sd">    :type parent: QAbstractItemView</span>
<span class="sd">    :param index: The index the action is for.</span>
<span class="sd">    :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>

<span class="sd">    :return: The data for the action and index.</span>
<span class="sd">    :rtype: dict (see the ViewItemAction class attribute `get_data` for more details)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_CHECK_NAME_ROLE</span><span class="p">)</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_CHECK_FUNC_ROLE</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">IS_GROUP_ITEM_ROLE</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEMS_ROLE</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_VALIDATION_RAN</span><span class="p">):</span>
        <span class="c1"># Modify the name to prepend &quot;Re&quot;, e.g. Validate -&gt; Revalidate</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Re</span><span class="si">{name}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">get_rule_fix_action_data</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback function triggered by the ViewItemDelegate.</span>

<span class="sd">    Get the data for displaying and executing the rule fix action.</span>

<span class="sd">    :param parent: The parent of the ViewItemDelegate which triggered this callback</span>
<span class="sd">    :type parent: QAbstractItemView</span>
<span class="sd">    :param index: The index the action is for.</span>
<span class="sd">    :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>

<span class="sd">    :return: The data for the action and index.</span>
<span class="sd">    :rtype: dict (see the ViewItemAction class attribute `get_data` for more details)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_FIX_NAME_ROLE</span><span class="p">)</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_FIX_FUNC_ROLE</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">IS_GROUP_ITEM_ROLE</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_ITEMS_ROLE</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">get_rule_status_action_data</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback function triggered by the ViewItemDelegate.</span>

<span class="sd">    Get the data for displaying the rule status.</span>

<span class="sd">    :param parent: The parent of the ViewItemDelegate which triggered this callback</span>
<span class="sd">    :type parent: QAbstractItemView</span>
<span class="sd">    :param index: The index the action is for.</span>
<span class="sd">    :type index: :class:`sgtk.platform.qt.QtCore.QModelIndex`</span>

<span class="sd">    :return: The data for the action and index.</span>
<span class="sd">    :rtype: dict (see the ViewItemAction class attribute `get_data` for more details)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">icon</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">ValidationRuleModel</span><span class="o">.</span><span class="n">RULE_STATUS_ICON_ROLE</span><span class="p">)</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="n">icon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;visible&quot;</span><span class="p">:</span> <span class="n">visible</span><span class="p">,</span>
        <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="n">icon</span><span class="p">,</span>
    <span class="p">}</span>


<span class="c1">#############################################################################################################</span>
<span class="c1"># Helper functions</span>


<span class="k">def</span> <span class="nf">_ensure_source_index</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience method to get the source index from the given index.</span>

<span class="sd">    :param index: The index to ensure is the source index</span>
<span class="sd">    :type index: QtGui.QModelIndex</span>

<span class="sd">    :return: The source index for the given index</span>
<span class="sd">    :rtype: QtGui.QModelIndex</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">src_model</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_model</span><span class="p">,</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSortFilterProxyModel</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">src_model</span><span class="o">.</span><span class="n">mapToSource</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">index</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Autodesk.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 

  <script type="text/javascript">
    window.wafCCPAForceShow = true;
    (function(a,b,c,d){
      a='https://tags.tiqcdn.com/utag/autodesk/micro-basic/prod/utag.js';
      b=document;c='script';d=b.createElement(c);d.src=a;d.type='text/java'+c;d.async=true;
      a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a);
    })();
  </script>


</body>
</html>